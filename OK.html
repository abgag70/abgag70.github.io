<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
<title>Image Point Selector with Visual Points</title>
<style>
  #imageContainer { position: relative; }
  img { max-width: 100%; cursor: crosshair; }
  #pointsList { max-height: 300px; overflow-y: auto; }
  .point { width: 3px; height: 3px; background-color: red; position: absolute; }
</style>
</head>
<body class="container py-4">

<h2 class="mb-4">Select Points on Your Image</h2>
<div class="custom-file mb-3">
  <input type="file" class="custom-file-input" id="imageInput" accept="image/*">
  <label class="custom-file-label" for="imageInput">Choose file</label>
</div>
<div id="imageContainer" class="mb-3">
  <img id="image" class="text-center img-fluid" alt="Selectable Image" style="display:none;">
</div>
<button class="btn btn-primary" onclick="resetPoints()">Reset Points</button>
<h3 class="mt-4">Points:</h3>
<ul id="pointsList" class="list-group"></ul>

<script>
  const imageInput = document.getElementById('imageInput');
  const imageContainer = document.getElementById('imageContainer');
  const image = document.getElementById('image');
  const pointsList = document.getElementById('pointsList');
  let points = [];

  imageInput.addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        image.src = e.target.result;
        image.style.display = 'block';
        resetPoints(); // Clear existing points when a new image is loaded
      };
      reader.readAsDataURL(file);
    }
  });

  image.addEventListener('click', function(event) {
    const rect = this.getBoundingClientRect();
    const x = event.clientX - rect.left; // x position within the element.
    const y = event.clientY - rect.top;  // y position within the element.

    const pointElement = createPointElement(x, y);
    imageContainer.appendChild(pointElement);

    points.push({x, y, element: pointElement});
    displayPoints();
  });

  function createPointElement(x, y) {
    // Container for the entire "X"
    const container = document.createElement('div');
    container.style.position = 'absolute';
    container.style.left = `${x - 2}px`; // Centering the "X" on the clicked point
    container.style.top = `${y - 2}px`;

    // Function to create each end of the "X"
    const createXEnd = (dx, dy) => {
      const end = document.createElement('div');
      end.style.position = 'absolute';
      end.style.width = '1px';
      end.style.height = '1px';
      end.style.backgroundColor = 'red';
      end.style.left = `${dx}px`;
      end.style.top = `${dy}px`;
      return end;
    };

    // Adjust these values to change the size of the "X"
    const size = 2; // Distance from the center to the end of each line of the "X"

    // Creating and positioning each end of the "X"
    const ends = [
      createXEnd(-size, -size), // Top-left
      createXEnd(size, -size),  // Top-right
      createXEnd(-size, size),  // Bottom-left
      createXEnd(size, size)    // Bottom-right
    ];

    // Add a small center piece to complete the "X"
    const center = createXEnd(0, 0);
    center.style.width = '3px';
    center.style.height = '3px';

    // Append the ends and the center to the container
    ends.forEach(end => container.appendChild(end));
    container.appendChild(center);

    return container;
  }

  function displayPoints() {
    pointsList.innerHTML = '';
    points.forEach((point, index) => {
        const listItem = document.createElement('li');
        listItem.classList.add('list-group-item');
        // Use Math.round to convert the coordinates to integers
        listItem.textContent = `Point ${index + 1}: (${Math.round(point.x)}, ${Math.round(point.y)})`;
        pointsList.appendChild(listItem);
     });
  }


  function resetPoints() {
    points.forEach(point => {
      point.element.remove(); // Remove point elements from the image
    });
    points = [];
    displayPoints();
  }

  // Update file input label after file selection
  $(".custom-file-input").on("change", function() {
    var fileName = $(this).val().split("\\").pop();
    $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
  });
</script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
